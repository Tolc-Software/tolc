<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WebAssembly with Tolc # - tolc</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <link rel="stylesheet" href="../../js/highlightjs/styles/vs2015.min.css">
    <script src="../../js/highlightjs/highlight.min.js" charset="utf-8" defer></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital@0;1&family=IBM+Plex+Sans:ital@0;1&display=swap" rel="stylesheet">

    <link rel="shortcut icon" href="../../assets/tolc-symbol-color-RGB.png">

    <link rel="stylesheet" href="../../css/theme.css">

    
    <script src="../../js/theme.js" charset="utf-8" defer></script>

    
    

    
    <script src="../../search/main.js"></script>
    

</head>

<body>
    <main id="root" class="mx-6">

        <nav id="topnavbar" class="navbar has-background-black" role="navigation" aria-label="main navigation">
            <div class="navbar-brand has-background-black">
                <a class="navbar-item" href="https://tolc.io">
                    <img src="../../assets/tolc-symbol-color-RGB.png">
                </a>
                <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="navbar-links">
                    <span aria-hidden="true"></span>
                    <span aria-hidden="true"></span>
                    <span aria-hidden="true"></span>
                </a>
            </div>

            <div id="navbar-links" class="navbar-menu has-background-black">
                <div class="navbar-end">
                    <a class="navbar-item is-size-5" href="https://tolc.io">Getting Started</a>
                    <a id="active-item" class="navbar-item is-size-5" href="https://docs.tolc.io/">Docs</a>
                    <a class="navbar-item is-size-5" href="https://tolc.io/blog">Blog</a>
                    <a class="navbar-item is-size-5" href="https://tolc.io/live">Live Demo</a>
                    <a class="navbar-item is-size-5" href="https://tolc.io/products">Products</a>
                    <a class="navbar-item is-size-5" href="https://tolc.io/account">Account</a>
                </div>
            </div>
        </nav>

        <div class="columns is-multiline">
            <div id="side-nav" class="column ml-3 is-one-quarter is-size-5">
                <ul>
                    
                    <!--

-->

<li class="nav-el">
    <a  href="../..">Introduction</a>
</li>

                    
                    <!--

-->

<li class="nav-el">
    <a  href="../../installing/">Installing</a>
</li>

                    
                    <!--

-->

<li class="nav-el">
    <a  href="../../usage/">Usage</a>
</li>

                    
                    <!--

-->

<li class="nav-el">
    <span class="nav-group has-text-grey">Python Interface</span>
    <ul class="nested-nav-el ml-4">
        
        <!--

-->

<li class="nav-el">
    <a  href="../../python/quickstart/">Quickstart</a>
</li>

        
        <!--

-->

<li class="nav-el">
    <a  href="../../python/examples/">Examples</a>
</li>

        
        <!--

-->

<li class="nav-el">
    <a  href="../../python/conversions/">Conversions</a>
</li>

        
        <!--

-->

<li class="nav-el">
    <a  href="../../python/template_naming_convention/">Template Naming Convention</a>
</li>

        
    </ul>
</li>

                    
                    <!--

-->

<li class="nav-el">
    <span class="nav-group has-text-grey">WebAssembly Interface</span>
    <ul class="nested-nav-el ml-4">
        
        <!--

-->

<li class="nav-el">
    <a  href="../quickstart/">Quickstart</a>
</li>

        
        <!--

-->

<li class="nav-el">
    <a  href="../examples/">Examples</a>
</li>

        
        <!--

-->

<li class="nav-el">
    <a  href="../conversions/">Conversions</a>
</li>

        
    </ul>
</li>

                    
                    <!--

-->

<li class="nav-el">
    <span class="nav-group has-text-grey">Objective-C Interface</span>
    <ul class="nested-nav-el ml-4">
        
        <!--

-->

<li class="nav-el">
    <a  href="../../objc/quickstart/">Quickstart</a>
</li>

        
        <!--

-->

<li class="nav-el">
    <a  href="../../objc/examples/">Examples</a>
</li>

        
        <!--

-->

<li class="nav-el">
    <a  href="../../objc/conversions/">Conversions</a>
</li>

        
        <!--

-->

<li class="nav-el">
    <a  href="../../objc/naming_convention/">Naming Convention</a>
</li>

        
    </ul>
</li>

                    
                    <!--

-->

<li class="nav-el">
    <span class="nav-group has-text-grey">CMake</span>
    <ul class="nested-nav-el ml-4">
        
        <!--

-->

<li class="nav-el">
    <a  href="../../cmake/interface/">Interface</a>
</li>

        
        <!--

-->

<li class="nav-el">
    <a  href="../../cmake/reference/">Reference</a>
</li>

        
    </ul>
</li>

                    
                    <!--

-->

<li class="nav-el">
    <a  href="../../FAQ/">FAQ</a>
</li>

                    
                </ul>
            </div>
            <div id="main-markdown" class="column is-half is-size-5 has-text-white mb-4 mx-4">
                
                <h1 id="webassembly-with-tolc">WebAssembly with Tolc</h1>
<p>In order for <code>C++</code> to be called from <code>javascript</code> there has to be an interface level. <code>tolc</code> generates this level from your already written <code>C++</code> interface.
To be as close to what an engineer would have written, <code>tolc</code> generates human readable <a href="https://emscripten.org/docs/porting/connecting_cpp_and_javascript/embind.html#embind"><code>embind</code></a>.
This is then compiled to a <code>.wasm</code> and a <code>.js</code> file that <code>javascript</code> can import.</p>
<h2 id="using-a-c-library-from-javascript">Using a <code>C++</code> library from <code>javascript</code></h2>
<p>This is a quick guide to using a <code>C++</code> library (here called <code>MyLib</code>) from <code>javascript</code>. We will:</p>
<ol>
<li>Download and use <code>Tolc</code></li>
<li>Download and set up <code>Emscripten</code></li>
<li>Use the resulting <code>WebAssembly</code> from <code>javascript</code></li>
</ol>
<p>The following works on all supported platforms. On all platforms you need <code>git</code> available in your <code>path</code>. Commands that should be run from a terminal starts with <code>$</code>, while comments starts with <code>#</code>.</p>
<h3 id="downloading-tolc">Downloading <code>Tolc</code></h3>
<p>Just add the following in a <code>CMakeLists.txt</code> below where the library you intend to use from <code>javascript</code> is defined:</p>
<pre><code class="language-cmake"># Download Tolc
# Can be [&quot;latest&quot;, &quot;v0.2.0&quot;, ...]
set(tolc_version latest)
include(FetchContent)
FetchContent_Declare(
  tolc_entry
  URL https://github.com/Tolc-Software/tolc/releases/download/${tolc_version}/tolc-${CMAKE_HOST_SYSTEM_NAME}.tar.xz
)
FetchContent_Populate(tolc_entry)

set(tolc_DIR ${tolc_entry_SOURCE_DIR}/lib/cmake/tolc)
find_package(
  tolc
  CONFIG
  REQUIRED
)

tolc_create_bindings(
  TARGET MyLib
  LANGUAGE wasm
  OUTPUT wasm-bindings
)
</code></pre>
<p>Assuming your library is called <code>MyLib</code>, and the bindings should be generated to the directory <code>wasm-bindings</code>.</p>
<h3 id="downloading-emscripten">Downloading <code>Emscripten</code></h3>
<p>In order to compile your library to <code>WebAssembly</code>, you need to download the <a href="https://emscripten.org/"><code>Emscripten compiler</code></a>. This is typically done via the <code>Emscripten SDK</code>. Navigate to the directory where you want to install and run the following commands:</p>
<pre><code class="language-shell"># Download SDK
$ git clone https://github.com/emscripten-core/emsdk.git
$ cd emsdk
</code></pre>
<p>Now follow the specifig commands for your platform.</p>
<h4 id="linuxmacos">Linux/MacOS</h4>
<p>From within the <code>emsdk</code> directory:</p>
<pre><code class="language-shell"># Download and install locally
$ ./emsdk install 3.1.3
# Writes configuration file .emscripten
$ ./emsdk activate 3.1.3
</code></pre>
<h4 id="windows">Windows</h4>
<p>From within the <code>emsdk</code> directory:</p>
<pre><code class="language-shell"># Download and install locally
$ emsdk.bat install 3.1.3
# Writes configuration file .emscripten
$ emsdk.bat activate 3.1.3
</code></pre>
<h3 id="configuring-your-project">Configuring Your Project</h3>
<p>Since <code>CMake</code> doesn't have native support for <code>WebAssembly</code> we have to provide a <code>toolchain</code> file, fortunately for us, <code>Emscripten</code> provides us with one.
When configuring your <code>CMake</code> project, just pass the toolchain flag <code>-DCMAKE_TOOLCHAIN_FILE=${EMSDK_DIRECTORY}/upstream/emscripten/cmake/Modules/Platform/Emscripten.cmake</code>. Where you need to replace <code>${EMSDK_DIRECTORY}</code> with the directory of the previously downloaded <code>Emscripten SDK</code>. Note that the directory separator used by <code>CMake</code> is always forward slash (<code>/</code>), even on Windows.</p>
<p>Example:</p>
<pre><code class="language-shell"># Configures project to build using Emscripten
$ cmake -S. -Bbuild -DCMAKE_TOOLCHAIN_FILE=${EMSDK_DIRECTORY}/upstream/emscripten/cmake/Modules/Platform/Emscripten.cmake
</code></pre>
<h3 id="using-from-javascript">Using From <code>javascript</code></h3>
<p>Looking into <code>build/tolc</code> you should see <code>MyLib.js</code> aswell as <code>MyLib.wasm</code>. <code>MyLib.js</code> exports a <code>Promise</code> that loads the built <code>WebAssembly</code>. Here is an example usage:</p>
<pre><code class="language-javascript">// run.js
const loadMyLib = require('./build/MyLib');

loadMyLib().then(MyLib =&gt; {
  // From here you can use the C++ functions of your library as usual
  MyLib.myCppFunction();
});
</code></pre>
<p>Running the file as normal:</p>
<pre><code class="language-shell">$ node run.js
</code></pre>
<h3 id="using-from-a-web-page">Using from a web page</h3>
<p>By default <code>Emscripten</code> assumes that you're running your code in a <code>node</code> environment (e.g. having access to the filesystem).
This is not the case on a web page served to a browser. If we add the link flag <code>-s ENVIRONMENT='web'</code> to <code>Emscripten</code> it will produce a serveable <code>WebAssembly</code> module.
Since <code>Tolc</code> exposes a <code>CMake</code> build target for the module, all we have to do is add the flag ourself:</p>
<pre><code class="language-cmake"># Creates the CMake target ${TARGET}_${LANGUAGE}
# In this case: MyLib_wasm
tolc_create_bindings(
  TARGET MyLib
  LANGUAGE wasm
  OUTPUT wasm-bindings
)

# Want to deploy to a web page
set_property(
  TARGET MyLib_wasm
  APPEND_STRING
  PROPERTY LINK_FLAGS &quot;-s ENVIRONMENT='web'&quot;)
</code></pre>
<p>Then we copy over <code>MyLib.js</code> and <code>MyLib.wasm</code> to our web application and load them as shown previously:</p>
<pre><code class="language-javascript">// app.js
const loadMyLib = require('./MyLib');

loadMyLib().then(MyLib =&gt; {
  // From here you can use the C++ functions of your library as usual
  MyLib.myCppFunction();
});
</code></pre>
<p>Assuming you've loaded the <code>javascript</code> within your page:</p>
<pre><code class="language-html">&lt;!-- index.html --&gt;
...
&lt;head&gt;
  &lt;script type=&quot;text/javascript&quot; src=&quot;./app.js&quot;&gt;&lt;/script&gt;
&lt;/head&gt;
...
</code></pre>
<p>For a complete example you can see the <code>Tolc-demo</code> repository: <a href="https://github.com/Tolc-Software/tolc-demo">https://github.com/Tolc-Software/tolc-demo</a>.</p>
<p>If you want to see what more is supported you can take a look at <a href="../examples/">the Examples section</a>.</p>
                
            </div>
            <div class="column is-one-quarter">
            </div>
        </div>

        <footer id="footer" class="footer first-content has-background-black">
            <div class="columns has-text-justified has-text-centered">
                <div class="column is-2">
                </div>
                <div class="column is-3 is-size-5">
                    <h1 class="mt-2 mb-5 has-text-weight-bold has-text-white">General</h1>
                    <p class="mt-2 mb-2">
                        <a class="link pt-2 pb-2" href="https://docs.tolc.io/">About</a>
                    </p>
                    <p class="mt-2 mb-2">
                        <a class="link" href="https://tolc.io/products">Products</a>
                    </p>
                    <p class="mt-2 mb-2">
                        <a class="link" href="https://tolc.io/contact">Contact</a>
                    </p>
                    <p class="mt-2 mb-2">
                        <a class="link" href="https://tolc.io/newsletter">Newsletter</a>
                    </p>
                </div>
                <div class="column is-3 is-size-5">
                    <h1 class="mt-2 mb-5 has-text-weight-bold has-text-white">Legal</h1>
                    <p class="mt-2 mb-2">
                        <a class="link" href="https://tolc.io/legal/privacy_policy">Privacy Policy</a>
                    </p>
                    <p class="mt-2 mb-2">
                        <a class="link" href="https://tolc.io/legal/terms_of_service">Terms of Service</a>
                    </p>
                    <p class="mt-2 mb-2">
                        <a class="link" href="https://tolc.io/legal/license">License</a>
                    </p>
                </div>
                <div class="column is-2 is-size-5">
                    <h1 class="mt-2 mb-5 has-text-weight-bold is-size-5 has-text-white">Keep In Touch</h1>
                    <p class="mt-2 mb-2">
                        <a class="link mx-1" href="https://github.com/Tolc-Software/tolc">
                            <i class="fab fa-github fa-lg"></i>
                        </a>
                        <a class="link mx-1" href="https://discord.gg/NwDxCGztjN">
                            <i class="fab fa-discord fa-lg"></i>
                        </a>
                        <a class="link mx-1" href="mailto:hello@tolc.io">
                            <i class="fas fa-envelope fa-lg"></i>
                        </a>
                    </p>
                </div>
                <div class="column is-2">
                </div>
            </div>
        </footer>
    </main>
</body>

</html>